<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å ±åˆ°ç³»çµ± | ä½³é‡Œå¥‡ç¾é†«é™¢114å¹´åº¦é¤æ•˜</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Noto Sans TC',sans-serif; background: linear-gradient(135deg,#E6E6FA,#FFFFFF); margin:0; padding:0; color:#000; overflow-x:hidden; position:relative; }
.bubble { position:absolute; border-radius:50%; opacity:0.5; pointer-events:none; z-index:0; }

.navbar { background: rgba(10,10,10,0.85); backdrop-filter: blur(10px); border-bottom:1px solid rgba(255,255,255,0.1); }
.navbar-brand, .nav-link { color:#D8BFD8 !important; font-weight:700; }
.nav-link:hover, .nav-link.active { color:#9370DB !important; }

h2 { color:#4B0082; font-weight:600; text-shadow:1px 1px 3px rgba(0,0,0,0.2); }

.card { background: rgba(255,255,255,0.9); border-radius:15px; padding:25px; box-shadow:0 10px 25px rgba(0,0,0,0.3); margin-bottom:40px; position:relative; z-index:1; }

.refresh-btn { background: linear-gradient(90deg,#4B0082,#7B68EE); color:#fff; border:none; font-weight:600; border-radius:10px; padding:10px 25px; transition:0.3s; }
.refresh-btn:hover { background: linear-gradient(90deg,#7B68EE,#9370DB); transform:scale(1.05); }

.timer { font-size:0.9rem; color:#4B0082; }

.table-responsive { max-height: 600px; overflow-y: auto; }
#checkinTable thead.table-dark { background-color: #D2B48C !important; color: #4B0082 !important; position: sticky; top: 0; z-index: 2; }
#checkinTable tbody tr:nth-child(even) { background-color: #F3E8FF; }
#checkinTable tbody tr:nth-child(odd) { background-color: #FFFFFF; }

.checked td { font-weight:700 !important; color:#1E90FF !important; background-color:#EAF6FF !important; }

.filter-input { width: 100%; font-size: 0.85rem; padding: 3px; border: 1px solid #ccc; border-radius: 5px; text-align: center; }

.small-text { font-size: 0.85rem; color: #555; }

#stats { font-size:1rem; font-weight:600; margin-bottom:15px; text-align:center; color:#4B0082; }

#checkinTable th:first-child,
#checkinTable th:nth-child(6),
#checkinTable td:first-child,
#checkinTable td:nth-child(6) { vertical-align: middle !important; text-align: center !important; white-space: nowrap; }

#checkinTable th:first-child, #checkinTable td:first-child { width: 60px; }
#checkinTable th:nth-child(6), #checkinTable td:nth-child(6) { width: 160px; }

footer { text-align:center; color:#555; background: rgba(255,255,255,0.1); padding:15px; font-size:0.95rem; margin-top:60px; }

/* æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
@media (max-width:768px){
  .card { padding: 15px; }
  .filter-input { font-size:0.75rem; padding:2px; }
  #globalSearch { width: 100% !important; }
  .refresh-btn { padding:8px 15px; font-size:0.9rem; }
  #checkinTable th, #checkinTable td { font-size:0.75rem; padding:4px; }
  .table-responsive { max-height:400px; }
}
</style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
  <div class="container">
    <a class="navbar-brand" href="index.html">ä½³é‡Œå¥‡ç¾é†«é™¢114å¹´åº¦é¤æ•˜</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="index.html">é¦–é </a></li>
        <li class="nav-item"><a class="nav-link" href="schedule.html">æ´»å‹•æµç¨‹</a></li>
        <li class="nav-item"><a class="nav-link" href="teachers.html">æ•™å¸«èŠ³åéŒ„</a></li>
        <li class="nav-item"><a class="nav-link active" href="checkin.html">å ±åˆ°ç³»çµ±</a></li>
        <li class="nav-item"><a class="nav-link" href="survey.html">æ»¿æ„åº¦èª¿æŸ¥</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container" style="padding-top:100px;">

<div class="text-center mb-5">
  <h2>ğŸ“ ç·šä¸Šå ±åˆ°è¡¨å–®</h2>
  <p class="text-dark">è«‹èˆ‡æœƒäººå“¡æ–¼ç¾å ´å¡«å¯«ä¸‹æ–¹è¡¨å–®é€²è¡Œå ±åˆ°</p>
</div>

<div class="card mb-4 p-4" style="max-width:700px;margin:auto;">
  <form id="customCheckinForm">
    <div class="mb-3">
      <label class="form-label">èº«åˆ†åˆ¥</label>
      <select name="identity" class="form-control" id="identitySelect" required>
        <option value="">è«‹é¸æ“‡</option>
        <option value="é™¢å…§äººå“¡">é™¢å…§äººå“¡</option>
        <option value="é™¢å¤–å˜‰è³“">é™¢å¤–å˜‰è³“ï¼ˆå«æœªå®Œæˆå ±åï¼‰</option>
      </select>
    </div>
    <div class="mb-3" id="internalField" style="display:none;">
      <label class="form-label">äººäº‹è™Ÿï¼ˆé™¢å…§äººå“¡å°ˆç”¨ï¼Œè‹±æ–‡å­—æ¯éœ€å¤§å¯«ï¼‰</label>
      <input type="text" name="internal" class="form-control" placeholder="è¼¸å…¥äººäº‹è™Ÿ">
    </div>
   <div class="mb-3" id="externalField" style="display:none;">
      <label class="form-label">å˜‰è³“å§“å</label>
      <input type="text" name="external" class="form-control" placeholder="è¼¸å…¥å§“å">
    </div>
    <div class="mb-3">
      <label class="form-label">å‚™è¨»(é¸å¡«)</label>
      <input type="text" name="remark" class="form-control" placeholder="å…¶ä»–èªªæ˜">
    </div>
    <div class="text-center">
      <button type="submit" class="refresh-btn">âœ… é€å‡ºå ±åˆ°</button>
    </div>
    <div id="formMessage" class="mt-2 text-success text-center"></div>
  </form>
</div>

<!-- å³æ™‚åå–® -->
<div class="text-center mb-4">
  <h2>âœ… å³æ™‚å ±åˆ°åå–®</h2>
  <p class="text-dark">å¯æ‰‹å‹•é‡æ–°æ•´ç†ï¼Œæˆ–æ¯ 20 ç§’è‡ªå‹•æ›´æ–°</p>
  <div class="d-flex justify-content-center align-items-center gap-3 mb-3 flex-wrap">
    <button class="refresh-btn" onclick="fetchCheckinData()">âŸ³ æ‰‹å‹•æ›´æ–°åå–®</button>
    <span id="countdown" class="timer"></span>
  </div>
  <div class="d-flex justify-content-center align-items-center gap-2 mb-3 flex-wrap">
    <input id="globalSearch" type="text" class="form-control w-50" placeholder="ğŸ” å…¨æ¬„æœå°‹ï¼ˆå§“åã€ç§‘åˆ¥ã€å–®ä½ã€ç‹€æ…‹ï¼‰">
    <button class="refresh-btn" onclick="filterTable()">ğŸ” æœå°‹</button>
  </div>
</div>

<div id="stats"></div>

<div class="card">
  <div class="table-responsive">
    <table class="table align-middle text-center" id="checkinTable">
      <thead class="table-dark">
        <tr>
          <th>åºè™Ÿ</th>
          <th>å§“å<br><input type="text" class="filter-input" placeholder="ç¯©é¸" onkeyup="columnFilter(1,this.value)"></th>
          <th>ç§‘åˆ¥<br><input type="text" class="filter-input" placeholder="ç¯©é¸" onkeyup="columnFilter(2,this.value)"></th>
          <th>å–®ä½<br><input type="text" class="filter-input" placeholder="ç¯©é¸" onkeyup="columnFilter(3,this.value)"></th>
          <th>ç‹€æ…‹<br><input type="text" class="filter-input" placeholder="ç¯©é¸" onkeyup="columnFilter(3,this.value)"></th>
          <th>å ±åˆ°æ™‚é–“</th>
          <th>å‚™è¨»<br><input type="text" class="filter-input" placeholder="ç¯©é¸" onkeyup="columnFilter(3,this.value)"></th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr><td colspan="7" class="text-center text-muted">è³‡æ–™è¼‰å…¥ä¸­...</td></tr>
      </tbody>
    </table>
  </div>
</div>

</main>

<footer>
Â© 2025 ä½³é‡Œå¥‡ç¾é†«é™¢ï¼æ•™å­¸ç ”ç©¶çµ„ | Designed for 114å¹´åº¦é¤æ•˜
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// æ³¡æ³¡å‹•ç•«èƒŒæ™¯
const bubbleColors=['#E6E6FA','#D8BFD8','#F0F8FF','#DDA0DD','#DA70D6','#9370DB'];
const bubbles=[]; const bubbleCount=40;
let width=window.innerWidth, height=window.innerHeight;
for(let i=0;i<bubbleCount;i++){
  let b=document.createElement('div'); b.classList.add('bubble');
  let size=Math.random()*40+20;
  b.style.width=size+'px'; b.style.height=size+'px';
  b.style.left=Math.random()*width+'px'; b.style.top=Math.random()*height+'px';
  b.style.background=bubbleColors[Math.floor(Math.random()*bubbleColors.length)];
  document.body.appendChild(b);
  bubbles.push({el:b,x:parseFloat(b.style.left),y:parseFloat(b.style.top),dx:(Math.random()-0.5)*0.5,dy:-Math.random()*0.7-0.2});
}
function animateBubbles(){ bubbles.forEach(b=>{ b.x+=b.dx;b.y+=b.dy;
  if(b.y+parseFloat(b.el.style.height)<0){b.y=height;b.x=Math.random()*width;}
  if(b.x<0)b.x=width;if(b.x>width)b.x=0;
  b.el.style.left=b.x+'px';b.el.style.top=b.y+'px';
}); requestAnimationFrame(animateBubbles); }
animateBubbles();
window.addEventListener('resize',()=>{width=window.innerWidth;height=window.innerHeight;});

// ------------------------
// è¨­å®šèˆ‡è³‡æ–™è™•ç†
// ------------------------
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyT8PHxSadUi-cL2B-kDpN9DkqqRopc7QLMaXDrgNziv-Jsj9jZ7EqtPTFQT_FhFadz/exec";
const tableBody = document.getElementById('tableBody');
const countdownEl = document.getElementById('countdown');
const statsEl = document.getElementById('stats');
const formMessage = document.getElementById('formMessage');
let counter=20;

// é™¢å…§/é™¢å¤–æ¬„ä½åˆ‡æ›
const identitySelect = document.getElementById('identitySelect');
const internalField = document.getElementById('internalField');
const externalField = document.getElementById('externalField');
identitySelect.addEventListener('change', ()=>{
  if(identitySelect.value==='é™¢å…§äººå“¡'){
    internalField.style.display='block';
    externalField.style.display='none';
  } else if(identitySelect.value==='é™¢å¤–å˜‰è³“'){
    internalField.style.display='none';
    externalField.style.display='block';
  } else {
    internalField.style.display='none';
    externalField.style.display='none';
  }
});

// è¡¨å–®é€å‡º
const form = document.getElementById('customCheckinForm');
form.addEventListener('submit', async e=>{
  e.preventDefault();
  const identity = form.querySelector('[name="identity"]').value;
  const internal = form.querySelector('[name="internal"]').value;
  const external = form.querySelector('[name="external"]').value;
  const remark = form.querySelector('[name="remark"]').value;

  const data = new URLSearchParams({identity, internal, external, remark});

  try{
    const res = await fetch(WEB_APP_URL, { method:'POST', body:data });
    const result = await res.json();
    if(result.status==='ok'){
      formMessage.textContent="âœ… å ±åˆ°æˆåŠŸï¼";
      formMessage.className="mt-2 text-success text-center";
      form.reset();
      internalField.style.display = externalField.style.display = 'none';
      fetchCheckinData();
    } else if(result.status==='not_found'){
      formMessage.textContent="âš ï¸ æŸ¥ç„¡æ­¤äººæˆ–å·²å ±åˆ°";
      formMessage.className="mt-2 text-warning text-center";
    } else {
      formMessage.textContent="âŒ ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦";
      formMessage.className="mt-2 text-danger text-center";
    }
  }catch(err){
    console.error(err);
    formMessage.textContent="âš ï¸ ç„¡æ³•é€å‡ºï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦";
    formMessage.className="mt-2 text-danger text-center";
  }
});

// å³æ™‚åå–®
async function fetchCheckinData(){
  try{
    tableBody.innerHTML=`<tr><td colspan="7" class="text-center text-muted">è³‡æ–™æ›´æ–°ä¸­...</td></tr>`;
    const res = await fetch(WEB_APP_URL);
    const data = await res.json();
    if(!data||data.length===0){ 
      tableBody.innerHTML=`<tr><td colspan="7" class="text-center text-muted">ç›®å‰å°šç„¡å ±åˆ°è³‡æ–™</td></tr>`;
      statsEl.textContent='';
      return;
    }
    tableBody.innerHTML='';
    let total=0,checked=0;
    data.forEach((p,i)=>{
      if(!p.name) return;
      total++;
      const row=document.createElement('tr');
      const isChecked=p.status==='å·²å ±åˆ°';
      if(isChecked){checked++; row.classList.add('checked');}
      row.innerHTML=`<td>${i+1}</td>
      <td>${p.name||''}</td>
      <td>${p.department||''}</td>
      <td>${p.unit||''}</td>
      <td>${p.status||'æœªå ±åˆ°'}</td>
      <td class="small-text">${p.time?new Date(p.time).toLocaleString():'â€”'}</td>
      <td>${p.remark||''}</td>`;
      tableBody.appendChild(row);
    });
    const rate = total ? ((checked/total)*100).toFixed(1) : 0;
    statsEl.innerHTML=`ç¸½å ±åäººæ•¸ï¼š${total} | å·²å ±åˆ°ï¼š${checked} / æœªå ±åˆ°ï¼š${total-checked} | å‡ºå¸­ç‡ï¼š${rate}%`;
  }catch(err){
    console.error(err);
    tableBody.innerHTML=`<tr><td colspan="7" class="text-danger">âš ï¸ è³‡æ–™è¼‰å…¥å¤±æ•—</td></tr>`;
  }
  counter=20;
}

// æ¬„ä½ç¯©é¸
function columnFilter(colIndex,value){
  const rows=tableBody.getElementsByTagName('tr');
  const filter=value.toLowerCase();
  for(let row of rows){
    const cell=row.cells[colIndex]?.textContent.toLowerCase()||'';
    row.style.display=cell.includes(filter)?'':'none';
  }
}
function filterTable(){
  const filter=document.getElementById('globalSearch').value.toLowerCase();
  const rows=tableBody.getElementsByTagName('tr');
  for(let row of rows){
    const text=row.textContent.toLowerCase();
    row.style.display=text.includes(filter)?'':'none';
  }
}

// è‡ªå‹•æ›´æ–°åå–®
setInterval(()=>{ counter--; if(counter<=0)fetchCheckinData(); countdownEl.textContent=`â³ ${counter} ç§’å¾Œè‡ªå‹•æ›´æ–°`; },1000);
fetchCheckinData();
</script>

</body>
</html>
