<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å ±åˆ°ç³»çµ± | ä½³é‡Œå¥‡ç¾é†«é™¢114å¹´åº¦é¤æ•˜</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
  font-family:'Noto Sans TC',sans-serif;
  background: linear-gradient(135deg,#E6E6FA,#FFFFFF);
  margin:0; padding:0; color:#000;
  overflow-x:hidden;
  position:relative;
}

/* æ¼‚æµ®æ³¡æ³¡ */
.bubble {
  position:absolute;
  border-radius:50%;
  opacity:0.5;
  pointer-events:none;
  z-index:0;
}

.navbar {
  background: rgba(10,10,10,0.85);
  backdrop-filter: blur(10px);
  border-bottom:1px solid rgba(255,255,255,0.1);
}
.navbar-brand, .nav-link { color:#D8BFD8 !important; font-weight:700; }
.nav-link:hover, .nav-link.active { color:#9370DB !important; }

h2 { color:#4B0082; font-weight:600; text-shadow:1px 1px 3px rgba(0,0,0,0.2); }

.card { background: rgba(255,255,255,0.9); border-radius:15px; padding:25px; box-shadow:0 10px 25px rgba(0,0,0,0.3); margin-bottom:40px; position:relative; z-index:1; }

.refresh-btn {
  background: linear-gradient(90deg,#4B0082,#7B68EE);
  color:#fff;
  border:none;
  font-weight:600;
  border-radius:10px;
  padding:10px 25px;
  transition:0.3s;
}
.refresh-btn:hover {
  background: linear-gradient(90deg,#7B68EE,#9370DB);
  transform:scale(1.05);
}

.timer { font-size:0.9rem; color:#4B0082; }

/* è¡¨æ ¼è¨­å®š */
.table-responsive {
  max-height: 600px;
  overflow-y: auto;
}
#checkinTable thead.table-dark {
  background-color: #D2B48C !important;
  color: #4B0082 !important;
  position: sticky;
  top: 0;
  z-index: 2;
}
#checkinTable tbody tr:nth-child(even) { background-color: #F3E8FF; }
#checkinTable tbody tr:nth-child(odd) { background-color: #FFFFFF; }

/* å·²å ±åˆ°è€…æ¨£å¼ */
.checked td {
  font-weight:700 !important;
  color:#1E90FF !important;
  background-color:#EAF6FF !important;
}

/* ç¯©é¸æ¬„ä½ */
.filter-input {
  width: 100%;
  font-size: 0.85rem;
  padding: 3px;
  border: 1px solid #ccc;
  border-radius: 5px;
  text-align: center;
}

/* å°å­—é«” */
.small-text {
  font-size: 0.85rem;
  color: #555;
}

/* çµ±è¨ˆå€å¡Š */
#stats { 
  font-size:1rem;
  font-weight:600;
  margin-bottom:15px;
  text-align:center;
  color:#4B0082;
}

footer {
  text-align:center;
  color:#555;
  background: rgba(255,255,255,0.1);
  padding:15px;
  font-size:0.95rem;
  margin-top:60px;
}
</style>
</head>
<body>

<!-- å°è¦½åˆ— -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
  <div class="container">
    <a class="navbar-brand" href="index.html">ä½³é‡Œå¥‡ç¾é†«é™¢114å¹´åº¦é¤æ•˜</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="index.html">é¦–é </a></li>
        <li class="nav-item"><a class="nav-link" href="schedule.html">æ´»å‹•æµç¨‹</a></li>
        <li class="nav-item"><a class="nav-link" href="teachers.html">æ•™å¸«èŠ³åéŒ„</a></li>
        <li class="nav-item"><a class="nav-link active" href="checkin.html">å ±åˆ°ç³»çµ±</a></li>
        <li class="nav-item"><a class="nav-link" href="survey.html">æ»¿æ„åº¦èª¿æŸ¥</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container" style="padding-top:100px;">

<!-- å ±åˆ°è¡¨å–® -->
<div class="text-center mb-5">
  <h2>ğŸ“ ç·šä¸Šå ±åˆ°è¡¨å–®</h2>
  <p class="text-dark">è«‹èˆ‡æœƒäººå“¡æ–¼ç¾å ´æƒææˆ–é»æ“Šä¸‹æ–¹è¡¨å–®é€²è¡Œå ±åˆ°</p>
</div>
<div class="card mb-4">
  <iframe src="https://docs.google.com/forms/d/e/1FAIpQLScfRD9jGQfE1KKhZL-e5GbQxMqrxF_jUktrbTq1ZPX-aTYYuA/viewform?embedded=true"
    width="100%" height="640" frameborder="0" marginheight="0" marginwidth="0">è¼‰å…¥ä¸­â€¦</iframe>
</div>

<!-- å³æ™‚åå–® -->
<div class="text-center mb-4">
  <h2>âœ… å³æ™‚å ±åˆ°åå–®</h2>
  <p class="text-dark">å¯æ‰‹å‹•é‡æ–°æ•´ç†ï¼Œæˆ–æ¯ 20 ç§’è‡ªå‹•æ›´æ–°</p>
  <div class="d-flex justify-content-center align-items-center gap-3 mb-3">
    <button class="refresh-btn" onclick="fetchCheckinData()">âŸ³ æ‰‹å‹•æ›´æ–°åå–®</button>
    <span id="countdown" class="timer"></span>
  </div>
  <input id="globalSearch" type="text" class="form-control w-50 mx-auto mb-3" placeholder="ğŸ” å…¨æ¬„æœå°‹ï¼ˆå§“åã€ç§‘åˆ¥ã€å–®ä½ã€ç‹€æ…‹ï¼‰" onkeyup="filterTable()">
</div>

<div id="stats"></div>

<div class="card">
  <div class="table-responsive">
    <table class="table align-middle text-center" id="checkinTable">
      <thead class="table-dark">
        <tr>
          <th>åºè™Ÿ</th>
          <th>å§“å<br><input type="text" class="filter-input" placeholder="ç¯©é¸" onkeyup="columnFilter(1, this.value)"></th>
          <th>ç§‘åˆ¥<br><input type="text" class="filter-input" placeholder="ç¯©é¸" onkeyup="columnFilter(2, this.value)"></th>
          <th>å–®ä½/èº«åˆ†<br><input type="text" class="filter-input" placeholder="ç¯©é¸" onkeyup="columnFilter(3, this.value)"></th>
          <th>å ±åˆ°ç‹€æ…‹<br><input type="text" class="filter-input" placeholder="ç¯©é¸" onkeyup="columnFilter(4, this.value)"></th>
          <th>å ±åˆ°æ™‚é–“</th>
          <th>å‚™è¨»<br><input type="text" class="filter-input" placeholder="ç¯©é¸" onkeyup="columnFilter(6, this.value)"></th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr><td colspan="7" class="text-center text-muted">è³‡æ–™è¼‰å…¥ä¸­...</td></tr>
      </tbody>
    </table>
  </div>
</div>
</main>

<footer>
Â© 2025 ä½³é‡Œå¥‡ç¾é†«é™¢ï¼æ•™å­¸ç ”ç©¶çµ„ | Designed for 114å¹´åº¦é¤æ•˜
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- æ¼‚æµ®æ³¡æ³¡èƒŒæ™¯ -->
<script>
const bubbleColors=['#E6E6FA','#D8BFD8','#F0F8FF','#DDA0DD','#DA70D6','#9370DB'];
const bubbles=[]; const bubbleCount=40;
let width=window.innerWidth, height=window.innerHeight;
for(let i=0;i<bubbleCount;i++){
  let b=document.createElement('div');
  b.classList.add('bubble');
  let size=Math.random()*40+20;
  b.style.width=size+'px'; b.style.height=size+'px';
  b.style.left=Math.random()*width+'px'; b.style.top=Math.random()*height+'px';
  b.style.background=bubbleColors[Math.floor(Math.random()*bubbleColors.length)];
  document.body.appendChild(b);
  bubbles.push({el:b,x:parseFloat(b.style.left),y:parseFloat(b.style.top),dx:(Math.random()-0.5)*0.5,dy:-Math.random()*0.7-0.2});
}
function animateBubbles(){
  bubbles.forEach(b=>{
    b.x+=b.dx; b.y+=b.dy;
    if(b.y+parseFloat(b.el.style.height)<0){b.y=height; b.x=Math.random()*width;}
    if(b.x<0) b.x=width; if(b.x>width) b.x=0;
    b.el.style.left=b.x+'px'; b.el.style.top=b.y+'px';
  });
  requestAnimationFrame(animateBubbles);
}
animateBubbles();
window.addEventListener('resize',()=>{width=window.innerWidth;height=window.innerHeight;});
</script>

<!-- è³‡æ–™è¼‰å…¥ -->
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwZxj65rXlINh9E9Ll_ukdTjAjrvPkooHyOHniPZ5kp-OMOdE15hVkGqBtWqRr2Wepe/exec";
const tableBody=document.getElementById('tableBody');
const countdownEl=document.getElementById('countdown');
const statsEl=document.getElementById('stats');
let counter=20;

async function fetchCheckinData(){
  try{
    tableBody.innerHTML=`<tr><td colspan="7" class="text-center text-muted">è³‡æ–™æ›´æ–°ä¸­...</td></tr>`;
    const res=await fetch(SCRIPT_URL);
    const data=await res.json();
    if(!data||data.length===0){tableBody.innerHTML=`<tr><td colspan="7" class="text-center text-muted">ç›®å‰å°šç„¡å ±åˆ°è³‡æ–™</td></tr>`;statsEl.textContent='';return;}
    tableBody.innerHTML='';
    let total=0,internalTotal=0,guestTotal=0,internalCheckedIn=0,guestCheckedIn=0;
    data.forEach((p,i)=>{
      if(!p.name||p.name.trim()==='')return;
      total++;
      const row=document.createElement('tr');
      const isGuest=p.unit&&p.unit.includes('å°å—å¸‚é†«å¸«å…¬æœƒ');
      const isChecked=p.status==='å·²å ±åˆ°';
      if(isGuest){guestTotal++;if(isChecked)guestCheckedIn++;}else{internalTotal++;if(isChecked)internalCheckedIn++;}
      if(isChecked)row.classList.add('checked');
      row.innerHTML=`
        <td>${i+1}</td>
        <td>${p.name||'â€”'}</td>
        <td>${p.department||'â€”'}</td>
        <td>${p.unit||'å¤–è³“ / æœªå¡«å–®ä½'}</td>
        <td>${p.status||'æœªå ±åˆ°'}</td>
        <td class="small-text">${p.time?new Date(p.time).toLocaleString():'â€”'}</td>
        <td>${p.remark||''}</td>`;
      tableBody.appendChild(row);
    });
    const totalChecked=internalCheckedIn+guestCheckedIn;
    const rate=total>0?((totalChecked/total)*100).toFixed(1):0;
    statsEl.innerHTML=`ç¸½å ±åäººæ•¸:${total} | å·²å ±åˆ°:${totalChecked} | æœªå ±åˆ°:${total-totalChecked} | å‡ºå¸­ç‡:${rate}%<br>
      é™¢å…§å·²å ±åˆ°/æœªå ±åˆ°:${internalCheckedIn}/${internalTotal-internalCheckedIn} | å¤–è³“å·²å ±åˆ°/æœªå ±åˆ°:${guestCheckedIn}/${guestTotal-guestCheckedIn}`;
  }catch(err){
    console.error(err);
    tableBody.innerHTML=`<tr><td colspan="7" class="text-danger">âš ï¸ è³‡æ–™è¼‰å…¥å¤±æ•—</td></tr>`;
    statsEl.textContent='';
  }
  counter=20;
}

function columnFilter(colIndex, value){
  const rows=tableBody.getElementsByTagName('tr');
  const filter=value.toLowerCase();
  for(let row of rows){
    const cell=row.cells[colIndex]?.textContent.toLowerCase()||'';
    row.style.display=cell.includes(filter)?'':'none';
  }
}

function filterTable(){
  const filter=document.getElementById('globalSearch').value.toLowerCase();
  const rows=tableBody.getElementsByTagName('tr');
  for(let row of rows){
    const text=row.textContent.toLowerCase();
    row.style.display=text.includes(filter)?'':'none';
  }
}

setInterval(()=>{
  counter--;
  if(counter<=0)fetchCheckinData();
  countdownEl.textContent=`â³ ${counter} ç§’å¾Œè‡ªå‹•æ›´æ–°`;
},1000);

fetchCheckinData();
</script>

</body>
</html>
